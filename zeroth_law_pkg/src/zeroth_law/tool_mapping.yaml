# File: src/zeroth_law/tool_mapping.yaml
# Zeroth Law Toolkit (zlt) Tool Mapping
# Maps ZLT actions/groups to underlying tool definitions.

actions:
  # === FORMAT ACTION ===
  format:
    description: Formats code according to project style guides.
    zlt_options:
      verbose:
        type: flag
        cli_name: -v
        description: Enable verbose output.
      quiet:
        type: flag
        cli_name: -q
        description: Suppress non-error output.
      config:
        type: value
        cli_name: --config
        value_type: path
        description: Path to configuration file.
      check:
        type: flag
        cli_name: --check
        description: Run in check mode (don't modify files).
      paths:
        type: positional
        description: Files or directories to format.
    tools:
      - definition_ref: tools/ruff/ruff_format.yaml
        option_links:
          verbose: verbose
          quiet: quiet
          config: config
          check: check
          paths: files # Map zlt paths to tool's 'files' positional arg

  # === LINT ACTION ===
  lint:
    description: Lints code for style and potential errors.
    zlt_options:
      verbose:
        type: flag
        cli_name: -v
        description: Enable verbose output.
      quiet:
        type: flag
        cli_name: -q
        description: Suppress non-error output.
      config:
        type: value
        cli_name: --config
        value_type: path
        description: Path to configuration file.
      exit_zero:
        type: flag
        cli_name: --exit-zero
        description: Exit with status code 0 even if issues are found.
      paths:
        type: positional
        description: Files or directories to lint.
    tools:
      - definition_ref: tools/ruff/ruff_check.yaml
        option_links:
          verbose: verbose
          quiet: quiet
          config: config
          exit_zero: exit_zero
          paths: files

  # === LINT-FIX ACTION ===
  lint-fix:
    description: Automatically fixes lint violations.
    zlt_options:
      verbose:
        type: flag
        cli_name: -v
        description: Enable verbose output.
      quiet:
        type: flag
        cli_name: -q
        description: Suppress non-error output.
      config:
        type: value
        cli_name: --config
        value_type: path
        description: Path to configuration file.
      # Add options specific to fixing?
      show_fixes:
        type: flag
        cli_name: --show-fixes
        description: Show explanations for applied fixes.
      unsafe_fixes:
        type: flag
        cli_name: --unsafe-fixes
        description: Apply potentially unsafe fixes.
      paths:
        type: positional
        description: Files or directories to fix.
    tools:
      - definition_ref: tools/ruff/ruff_check.yaml
        default_args: ["--fix"] # Always add --fix for this action
        option_links:
          verbose: verbose
          quiet: quiet
          config: config
          show_fixes: show_fixes
          unsafe_fixes: unsafe_fixes
          paths: files

  # === TEST ACTION ===
  test:
    description: Runs automated tests.
    zlt_options:
      verbose:
        type: flag
        cli_name: -v
        description: Increase verbosity.
      quiet:
        type: flag
        cli_name: -q
        description: Decrease verbosity.
      config:
        type: value
        cli_name: -c # Map ZLT config to pytest -c
        value_type: path
        description: Path to pytest configuration file.
      keyword:
        type: value
        cli_name: -k
        value_type: string
        description: Run tests matching keyword expression.
      marker:
        type: value
        cli_name: -m
        value_type: string
        description: Run tests matching marker expression.
      exitfirst:
        type: flag
        cli_name: -x
        description: Exit instantly on first error or failed test.
      collect_only:
        type: flag
        cli_name: --collect-only
        description: Only collect tests, don't execute.
      paths:
        type: positional
        description: Files or directories for test discovery.
    tools:
      - definition_ref: tools/pytest/pytest.yaml
        option_links:
          verbose: verbose
          quiet: quiet
          config: config_file # Link ZLT 'config' to pytest's 'config_file' (-c)
          keyword: keyword
          marker: marker
          exitfirst: exitfirst
          collect_only: collect_only
          paths: file_or_dir

  # === CHECK-TYPES ACTION ===
  check-types:
    description: Performs static type checking.
    zlt_options:
      verbose:
        type: flag
        cli_name: -v
        description: More verbose messages.
      quiet:
        type: flag
        cli_name: -q
        description: Suppress non-error messages.
      config:
        type: value
        cli_name: --config-file
        value_type: path
        description: Path to mypy configuration file.
      strict:
        type: flag
        cli_name: --strict
        description: Enable strict checking.
      ignore_missing_imports:
        type: flag
        cli_name: --ignore-missing-imports
        description: Suppress errors about unresolved imports.
      paths:
        type: positional
        description: Files or directories to type check.
    tools:
      - definition_ref: tools/mypy/mypy.yaml
        option_links:
          verbose: verbose
          quiet: quiet
          config: config_file
          strict: strict
          ignore_missing_imports: ignore_missing_imports
          paths: files

  # === COVERAGE GROUP ===
  coverage:
    type: group
    description: Code coverage operations.
    actions:
      run:
        description: Run tests with coverage measurement.
        zlt_options:
          module:
            type: value
            cli_name: -m
            value_type: string
            description: Run library module as a script.
          source:
            type: value
            cli_name: --source
            value_type: string
            description: Measure coverage for specified source files/packages.
          append:
            type: flag
            cli_name: -a
            description: Append data to existing coverage file.
          config:
            type: value
            cli_name: --rcfile
            value_type: path
            description: Specify coverage configuration file.
          paths:
            type: positional
            description: Module or script path to run under coverage.
        tools:
          - definition_ref: tools/coverage/coverage_run.yaml
            option_links:
              module: module # Maps ZLT '-m' to the coverage '-m' flag logic
              source: source
              append: append
              config: config_file
              paths: module_or_script_path # Maps ZLT paths to tool's positional

      report:
        description: Generate a text coverage report.
        zlt_options:
          fail_under:
            type: value
            cli_name: --fail-under
            value_type: integer
            description: Exit with status 2 if coverage is below MIN.
          config:
            type: value
            cli_name: --rcfile
            value_type: path
            description: Specify coverage configuration file.
          skip_covered:
            type: flag
            cli_name: --skip-covered
            description: Skip modules with 100% coverage in the report.
          sort:
            type: value
            cli_name: --sort
            value_type: string
            description: Sort report by column (Name, Stmts, Miss, etc.).
        tools:
          - definition_ref: tools/coverage/coverage_report.yaml
            option_links:
              fail_under: fail_under
              config: config_file
              skip_covered: skip_covered
              sort: sort

      html:
        description: Generate an HTML coverage report.
        zlt_options:
          directory:
            type: value
            cli_name: -d
            value_type: path
            description: Write the HTML report to DIR.
          fail_under:
            type: value
            cli_name: --fail-under
            value_type: integer
            description: Exit with status 2 if coverage is below MIN.
          config:
            type: value
            cli_name: --rcfile
            value_type: path
            description: Specify coverage configuration file.
          title:
            type: value
            cli_name: --title
            value_type: string
            description: Set the title for the HTML report.
        tools:
          - definition_ref: tools/coverage/coverage_html.yaml
            option_links:
              directory: directory
              fail_under: fail_under
              config: config_file
              title: title

  # === PLACEHOLDER ACTIONS ===
  security:
    description: Scans code for security vulnerabilities. (Not Implemented)
    zlt_options: {}
    tools: []
  duplicate:
    description: Detects duplicate code. (Not Implemented)
    zlt_options: {}
    tools: []
  fuzz:
    description: Runs fuzz tests to find unexpected behavior. (Not Implemented)
    zlt_options: {}
    tools: []
