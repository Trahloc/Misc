#!/usr/bin/env python3

import subprocess

def run_command(command, output_file=None, append=False, sudo=False):
    """Runs a shell command and optionally writes the output to a file."""
    try:
        if sudo:
            command = ["sudo"] + command
        process = subprocess.run(command, capture_output=True, text=True, check=True)
        output = process.stdout

        if output_file:
            mode = "a" if append else "w"
            with open(output_file, mode, encoding='utf-8') as f:
                f.write(output)
        return output

    except subprocess.CalledProcessError as e:
        print(f"Error running command: {e}")
        if e.stderr:
            print(f"Stderr: {e.stderr}")
        return None
    except FileNotFoundError as e:
        print(f"Command not found: {e}")
        return None
    except PermissionError as e:
        print(f"Permission error: {e}")
        return None

def gather_system_info():
    """Gathers system information and writes it to files."""

    run_command(["uname", "-a"], "system_info.txt")
    run_command(["uptime"], "system_info.txt", append=True)
    run_command(["date"], "system_info.txt", append=True)
    run_command(["whoami"], "system_info.txt", append=True)
    run_command(["hostname"], "system_info.txt", append=True)
    run_command(["echo", "--- IP Addresses ---"], "system_info.txt", append=True)
    run_command(["ip", "a"], "system_info.txt", append=True)
    run_command(["echo", "--- Memory Usage ---"], "system_info.txt", append=True)
    run_command(["free", "-h"], "system_info.txt", append=True)
    run_command(["echo", "--- Disk Usage ---"], "system_info.txt", append=True)
    run_command(["df", "-h"], "system_info.txt", append=True)
    run_command(["echo", "--- CPU Info ---"], "system_info.txt", append=True)
    run_command(["lscpu"], "system_info.txt", append=True)
    run_command(["echo", "--- Mounted Filesystems ---"], "system_info.txt", append=True)
    run_command(["mount"], "system_info.txt", append=True)

    run_command(["ps", "aux"], "running_processes.txt")
    run_command(["netstat", "-tulnp"], "network_stats.txt")

    run_command(["journalctl", "-xe"], "system_logs.txt", sudo=True)
    run_command(["lshw","-html"], "hardware_info.html", sudo=True)
    run_command(["find", "/", "-type", "f", "-perm", "-0002", "-print"], "world_writable_files.txt")

    print("System information gathering complete.")

if __name__ == "__main__":
    gather_system_info()